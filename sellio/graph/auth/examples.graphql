# Auth Flow Examples

# Get current user (check if logged in)
query GetCurrentUser {
  currentUser {
    id
    phone
    firstName
    secondName
    lastName
    email
    isProfileCompleted
    isSuperuser
  }
}

# Expected response (authenticated):
# {
#   "data": {
#     "currentUser": {
#       "id": 123,
#       "phone": "+380501234567",
#       "firstName": "Іван",
#       "secondName": "Петрович",
#       "lastName": "Сидоренко",
#       "email": "ivan@example.com",
#       "isProfileCompleted": true,
#       "isSuperuser": false
#     }
#   }
# }

# Expected response (not authenticated):
# {
#   "data": {
#     "currentUser": null
#   }
# }


# Step 1: Request OTP code
# Send phone number, system generates 4-digit code from last 4 digits
mutation RequestCode {
  requestAuthCode(phone: "+380501234567") {
    status
    message
  }
}

# Expected response:
# {
#   "data": {
#     "requestAuthCode": {
#       "status": "CODE_SENT",
#       "message": "Verification code sent to +380501234567"
#     }
#   }
# }
# OTP code will be: 4567 (last 4 digits of phone)


# Step 2: Verify OTP code
# If user exists - logs in
# If user doesn't exist - creates user and returns PROFILE_INFO_REQUIRED
mutation VerifyCode {
  verifyAuthCode(phone: "+380501234567", code: "4567") {
    status
    message
    sessionToken
    userId
    profileRequired
  }
}

# Expected response (new user):
# {
#   "data": {
#     "verifyAuthCode": {
#       "status": "PROFILE_INFO_REQUIRED",
#       "message": "Please complete your profile",
#       "sessionToken": "very-long-session-token-here",
#       "userId": 123,
#       "profileRequired": true
#     }
#   }
# }

# Expected response (existing user with completed profile):
# {
#   "data": {
#     "verifyAuthCode": {
#       "status": "SUCCESS",
#       "message": "Successfully authenticated",
#       "sessionToken": "very-long-session-token-here",
#       "userId": 123,
#       "profileRequired": false
#     }
#   }
# }


# Step 3: Complete profile (only if profileRequired = true)
# Session token automatically retrieved from cookie
mutation CompleteProfile {
  completeProfile(
    firstName: "Іван"
    secondName: "Петрович"
    lastName: "Сидоренко"
    email: "ivan@example.com"
  ) {
    status
    message
    userId
  }
}

# Expected response:
# {
#   "data": {
#     "completeProfile": {
#       "status": "SUCCESS",
#       "message": "Profile completed successfully",
#       "userId": 123
#     }
#   }
# }


# Step 4: Logout
mutation Logout {
  logout {
    status
    message
  }
}

# Expected response:
# {
#   "data": {
#     "logout": {
#       "status": "SUCCESS",
#       "message": "Successfully logged out"
#     }
#   }
# }


# Error cases:

# Invalid OTP code:
mutation VerifyInvalidCode {
  verifyAuthCode(phone: "+380501234567", code: "0000") {
    status
    message
    sessionToken
    userId
    profileRequired
  }
}
# Response:
# {
#   "data": {
#     "verifyAuthCode": {
#       "status": "INVALID_CODE",
#       "message": "Invalid or expired verification code",
#       "sessionToken": null,
#       "userId": null,
#       "profileRequired": false
#     }
#   }
# }

